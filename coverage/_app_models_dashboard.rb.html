<html>
  <head>
    <meta charset='utf-8'>
    <title>/home/jeremiah/railsProjects/EntryApplication/app/models/dashboard.rb</title>
    <link rel="stylesheet" href="css/coco.css" type="text/css" />
  </head>
  <body>
    <p class="menu">
      <a href="index.html">Index</a> <img src="img/coconut16.png" width="16" height="16" />
      <a href="https://github.com/lkdjiin/coco/wiki">Wiki</a> <img src="img/coconut16.png" width="16" height="16" />
      <a href="https://github.com/lkdjiin/coco">Source</a> <img src="img/coconut16.png" width="16" height="16" />
      <a href="http://lkdjiin.github.com/coco/">Web site</a>
    </p>
    <h2>/home/jeremiah/railsProjects/EntryApplication/app/models/dashboard.rb</h2>
    <p class="date">2013-11-15 14:46:05 -0500</p>
    
    <table class="source">
      
                    <tr class="hit" %>      
      <td><pre>1 </pre></td><td><pre>class Dashboard</pre></td>
        </tr>
                    <tr class="hit" %>      
      <td><pre>2 </pre></td><td><pre>  def diver_list(current_diver)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>3 </pre></td><td><pre>    if current_diver.role == "admin"</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>4 </pre></td><td><pre>      @boat_logs      = BoatLog.all</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>5 </pre></td><td><pre>      @boatlog_divers = RepLog.group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>6 </pre></td><td><pre>      @sample_divers  = DiverSample.primary.group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>7 </pre></td><td><pre>      @lpi_divers     = BenthicCover.group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>8 </pre></td><td><pre>      @demo_divers    = CoralDemographic.group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>9 </pre></td><td><pre>      hash_merge(@boatlog_divers, @sample_divers, @lpi_divers, @demo_divers).keys</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>10 </pre></td><td><pre>    else</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>11 </pre></td><td><pre>      @boat_logs      = BoatLog.where( "boatlog_manager_id=?", current_diver.boatlog_manager_id )</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>12 </pre></td><td><pre>      @boatlog_divers = RepLog.joins(station_log: :boat_log).where("boat_logs.boatlog_manager_id = ?", current_diver.boatlog_manager_id).group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>13 </pre></td><td><pre>      @sample_divers  = DiverSample.primary.joins(:sample).where("samples.boatlog_manager_id = ?", current_diver.boatlog_manager_id).group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>14 </pre></td><td><pre>      @lpi_divers     = BenthicCover.where("boatlog_manager_id = ?", current_diver.boatlog_manager_id).group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>15 </pre></td><td><pre>      @demo_divers    = CoralDemographic.where("boatlog_manager_id = ?", current_diver.boatlog_manager_id).group(:diver_id).count(:id)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>16 </pre></td><td><pre>      hash_merge(@boatlog_divers, @sample_divers, @lpi_divers, @demo_divers).keys</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>17 </pre></td><td><pre>    end</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>18 </pre></td><td><pre>  end</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>19 </pre></td><td><pre></pre></td>
        </tr>
                    <tr class="hit" %>      
      <td><pre>20 </pre></td><td><pre>  def hash_merge *hashes</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>21 </pre></td><td><pre>    hashes.inject :merge</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>22 </pre></td><td><pre>  end</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>23 </pre></td><td><pre></pre></td>
        </tr>
                    <tr class="hit" %>      
      <td><pre>24 </pre></td><td><pre>  def check_val (v)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>25 </pre></td><td><pre>    v.nil? ? 0 : v</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>26 </pre></td><td><pre>  end</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>27 </pre></td><td><pre></pre></td>
        </tr>
                    <tr class="hit" %>      
      <td><pre>28 </pre></td><td><pre>  def divers(current_diver)</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>29 </pre></td><td><pre>    organized_hash = {}</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>30 </pre></td><td><pre>    diver_list(current_diver).each do |diver|</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>31 </pre></td><td><pre>      organized_hash[Diver.find(diver).diver_name] = { "boat"   =&gt; check_val(@boatlog_divers[diver]),</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>32 </pre></td><td><pre>        "sample" =&gt; check_val(@sample_divers[diver]),</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>33 </pre></td><td><pre>        "lpi"    =&gt; check_val(@lpi_divers[diver]),</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>34 </pre></td><td><pre>        "demo"   =&gt; check_val(@demo_divers[diver]) }</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>35 </pre></td><td><pre>    end</pre></td>
        </tr>
                    <tr class="miss">
      
      <td><pre>36 </pre></td><td><pre>    organized_hash.sort_by { |diver, data| diver }</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>37 </pre></td><td><pre>  end</pre></td>
        </tr>
                    <tr class="never">
      
      <td><pre>38 </pre></td><td><pre>end</pre></td>
        </tr>
            
    </table>
  </body>
</html>
